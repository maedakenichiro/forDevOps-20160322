machine:
  timezone:
    Asia/Tokyo

dependencies:
    override:
        - sudo pip install awscli
    post:
        - aws configure set region ap-northeast-1

test:
  override:
    - echo "Nothing to do here"

deployment:
  production: # just a label; label names are completely up to you
    branch: master
    commands:
      - sed -i -e "s/REPLACE-DATA-BACKET/maeda-fordevops-master-form-20160322/g" html/js/form.js
      - aws s3 sync html/ s3://maeda-fordevops-master-20160322/ --delete
      - cd lambda/ && zip -r lambda.zip ./*
      - aws lambda update-function-code --function-name maeda-fordevops-master-form-20160322 --zip-file fileb://./lambda/lambda.zip --publish
  staging:
    branch: staging
    commands:
      - sed -i -e "s/REPLACE-DATA-BACKET/maeda-fordevops-form-20160322/g" html/js/form.js
      - aws s3 sync html/ s3://maeda-fordevops-20160322/ --delete
      - cd lambda/sendMailTest/ && zip -r sendMailTest.zip ./*
      #- aws lambda update-function-code --function-name maeda-fordevops-form-20160322 --zip-file fileb://./lambda/sendMailTest/sendMailTest.zip --publish
      - aws lambda create-function --function-name maeda-fordevops-form-20160323 --function-arn arn:aws:s3:::maeda-fordevops-form-20160322 --runtime nodejs --role arn:aws:iam::684142680491:role/maeda-mycorpsite-lambda-role-20160322 --handler index.handler --description Staging --zip-file fileb://./lambda/sendMailTest/sendMailTest.zip --publish
